# 상태의 불변성이 중요한 이유

## 불변성이란
메모리 영역의 값을 변경할 수 없는 것을 의미합니다.

<br/>

## js 메모리 구조

![js_memory](https://user-images.githubusercontent.com/90454621/229724076-54ecb588-a344-4b13-a709-641912f0bc6d.png)

js 엔진은 3가지의 메모리 공간을 가진다.

- code area :
실행한 js 코드를 담는다.

- call stack :
실행 중인 함수를 추적하며 계산을 수행하고, 지역 변수를 저장한다. 변수들은 LIFO 형식으로 저장된다. 또한 원시 타입들이 이 곳에 저장된다.

- Heap :
참조 타입들이 할당되는 곳이다. 콜 스택과 달리, Heap의 메모리 할당은 랜덤하게 배치된다. 또한 메모리 누수를 방지하기 위해 JS 엔진의 메모리 관리자가 항상 관리한다.

<br/>

## java script의 원시타입과 참조타입의 데이터 저장 방식
![save](https://user-images.githubusercontent.com/90454621/229724796-a79d4941-ac7a-44b1-ad7b-9a38c33ef6e1.png)
- 원시타입: 변수 a에 값 10을 저장을 했을 경우 콜 스택의 변수값에 10이 그대로 저장됩니다.
- 참조타입: 변수 b,c,d에 array, object를 저장할 경우 실제 값은 메모리 힙에 저장되고, 메모리의 힙의 주소가 콜 스택의 값에 저장이 됩니다.

<br/>

## 변수 할당과 재할당
![원시](https://user-images.githubusercontent.com/90454621/229727540-77a4fd3d-b036-49f5-b114-cfab0683711b.png)

원시타입의 변수는 변수값을 변경하라는 명령을 받을 경우, 기존 콜스택의 값을 변경하지 않고 새로운 주소를 추가해 값을 저장하고 변수 b가 바라보게 합니다. 이것을 저희가 궁금해 하던 불변성이라고 합니다.(주소값은 변경되지 않는다!)

<br/>

![참조](https://user-images.githubusercontent.com/90454621/229727550-d3c2654e-c60b-4aa7-b75a-edd5eafb4dfc.png)

기존의 변수를 변경하는 경우를 살펴보면, 변수 값이 변경되면 콜스택의 변화는 없으며 메모리 힙의 value 값만 변경된다. 즉, 기존의 메모리 영역의 값이 변경되므로 불변성 유지가 되지 않습니다.

<br/>

![image](https://user-images.githubusercontent.com/90454621/229733861-6880990b-4601-4074-b37d-ddf2bc01aeed.png)

깊은 복사를 통한 방법으로 참조형변수의 불변성을 유지할 수 있습니다.

<br/>

## 결론
리액트에서 불변성이 중요한 이유는 콜스택의 주소값의 비교를 통해 상태 변화를 감지하기 때문에 불변성이 지켜지지 않으면 리렌더링이 일어나지 않게 되기 때문입니다.

<br/>

## 참고
https://velog.io/@badahertz52/%EC%B0%B8%EC%A1%B0%ED%83%80%EC%9E%85%EA%B3%BC-React%EC%9D%98-%EB%B6%88%EB%B3%80%EC%84%B1



